@page
@model IdentityAjaxClient.Pages.OrchidPage.Management.IndexModel

@{
    ViewData["Title"] = "Orchid Management";
}

<h1>Orchid Management</h1>

<p>
    <a asp-page="Create" class="btn btn-primary">Create New</a>
</p>

<!-- Search and Filter Form -->
<form method="get" class="mb-4">
    <div class="row g-3">
        <div class="col-md-2">
            <label for="nameSearch" class="form-label">Name</label>
            <input type="text" class="form-control" id="nameSearch" name="nameSearch" value="@Model.NameSearch">
        </div>
        <div class="col-md-2">
            <label for="categorySearch" class="form-label">Category</label>
            <input type="text" class="form-control" id="categorySearch" name="categorySearch" value="@Model.CategorySearch">
        </div>
        <div class="col-md-2">
            <label for="isNatural" class="form-label">Natural Type</label>
            <select class="form-select" id="isNatural" name="isNatural" asp-for="@Model.IsNatural">
                <option value="">All</option>
                <option value="true">Natural</option>
                <option value="false">Hybrid</option>
            </select>
        </div>
        <div class="col-md-2 align-self-end">
            <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
        <div class="col-md-2 align-self-end">
            <a asp-page="./Index" class="btn btn-secondary w-100">Clear</a>
        </div>
    </div>
</form>

<!-- Results Table -->
<div class="table-responsive">
    @if (!Model.Orchid?.Items.Any() ?? true)
    {
        <div class="alert alert-info">
            No orchids found matching your criteria.
        </div>
    }
    else
    {
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Natural Type</th>
                    <th>Description</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Orchid.Items)
                {
                    <tr>
                        <td>@item.OrchidName</td>
                        <td>@item.Category?.CategoryName</td>
                        <td>@item.Price?.ToString("C", new System.Globalization.CultureInfo("en-US"))</td>
                        <td>@(item.IsNatural.GetValueOrDefault() ? "Natural" : "Hybrid")</td>
                        <td>@(item.OrchidDescription?.Length > 50 ? item.OrchidDescription[..50] + "..." : item.OrchidDescription)</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.OrchidUrl))
                            {
                                <img src="@item.OrchidUrl" alt="@item.OrchidName" style="max-height: 50px;" />
                            }
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a asp-page="./Edit" asp-route-id="@item.OrchidId" class="btn btn-sm btn-primary">Edit</a>
                                <a asp-page="./Details" asp-route-id="@item.OrchidId" class="btn btn-sm btn-info">Details</a>
                                <a asp-page="./Delete" asp-route-id="@item.OrchidId" class="btn btn-sm btn-danger">Delete</a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Pagination -->
            @if (Model.Orchid.TotalPages > 1)
            {
                var prevDisabled = !Model.Orchid.HasPreviousPage ? "disabled" : "";
                var nextDisabled = !Model.Orchid.HasNextPage ? "disabled" : "";

                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                        Showing @Model.Orchid.PageSize items of @Model.Orchid.TotalCount total
                    </div>
                    <div>
                        <nav aria-label="Page navigation">
                            <ul class="pagination mb-0">
                                <li class="page-item @prevDisabled">
                                    <a class="page-link" asp-page="./Index"
                                       asp-route-pageIndex="@(Model.Orchid.PageNumber - 1)"
                                       asp-route-pageSize="@Model.Orchid.PageSize"
                                       asp-route-nameSearch="@Model.NameSearch"
                                       asp-route-categorySearch="@Model.CategorySearch"
                                       asp-route-isNatural="@Model.IsNatural">Previous</a>
                                </li>
                                @for (var i = 1; i <= Model.Orchid.TotalPages; i++)
                                {
                                    <li class="page-item @(i == Model.Orchid.PageNumber ? "active" : "")">
                                        <a class="page-link" asp-page="./Index"
                                           asp-route-pageIndex="@i"
                                           asp-route-pageSize="@Model.Orchid.PageSize"
                                           asp-route-nameSearch="@Model.NameSearch"
                                           asp-route-categorySearch="@Model.CategorySearch"
                                           asp-route-isNatural="@Model.IsNatural">@i</a>
                                    </li>
                                }
                                <li class="page-item @nextDisabled">
                                    <a class="page-link" asp-page="./Index"
                                       asp-route-pageIndex="@(Model.Orchid.PageNumber + 1)"
                                       asp-route-pageSize="@Model.Orchid.PageSize"
                                       asp-route-nameSearch="@Model.NameSearch"
                                       asp-route-categorySearch="@Model.CategorySearch"
                                       asp-route-isNatural="@Model.IsNatural">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
        }
    }
</div>

@section Styles {
    <style>
        .table img {
            object-fit: cover;
            border-radius: 4px;
        }
        .table td {
            vertical-align: middle;
        }
    </style>
}